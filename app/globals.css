@tailwind base;
@tailwind components;
@tailwind utilities;

@import "@liveblocks/react-ui/styles.css";
@import "@liveblocks/react-lexical/styles.css";

@import "../styles/dark-theme.css";
@import "../styles/comment-theme.css";

/* ========================================== TAILWIND STYLES */
@layer base {
  :root {
    background: #09111f;
    color: #fff;
    margin: 0;
    
    /* Global scrollbar styling */
    scrollbar-width: thin;
    scrollbar-color: #565f73 rgb(22, 25, 32);
  }

  /* Global scrollbar styling for Webkit browsers */
  ::-webkit-scrollbar {
    width: 10px;
    height: 10px;
    background: transparent;
  }

  ::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb {
    background: #565f73;
    border-radius: 10px;
    border: 2px solid rgb(22, 25, 32);
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #636c84;
  }

  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
    height: 4px;
    border-radius: 50px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: #09090a;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #565f73;
    border-radius: 50px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #636c84;
  }
}

@layer utilities {
  .text-28-semibold {
    @apply text-[28px] font-semibold;
  }
  .text-10-regular {
    @apply text-[10px] font-normal;
  }

  .gradient-blue {
    @apply bg-gradient-to-t from-blue-500 to-blue-400;
  }
  .gradient-red {
    @apply bg-gradient-to-t from-red-500 to-red-400;
  }

  .shad-dialog {
    @apply w-full max-w-[400px] rounded-xl border-none bg-doc bg-cover px-5 py-7 shadow-xl sm:min-w-[500px] !important;
  }

  .shad-dialog button {
    @apply focus:ring-0 focus:ring-offset-0 focus-visible:border-none focus-visible:outline-none focus-visible:ring-transparent focus-visible:ring-offset-0 !important;
  }

  .shad-select {
    @apply w-fit border-none bg-transparent text-blue-100 !important;
  }

  .shad-select svg {
    @apply ml-1 mt-1;
  }

  .shad-select-item {
    @apply cursor-pointer bg-dark-200 text-blue-100 focus:bg-dark-300 hover:bg-dark-300 focus:text-blue-100 !important;
  }

  .shad-popover {
    @apply w-[460px] border-none bg-dark-200 shadow-lg !important;
  }

  .floating-toolbar {
    @apply flex w-full min-w-max items-center justify-center gap-2 rounded-lg bg-dark-350 p-1.5 shadow-xl;
  }

  .floating-toolbar-btn {
    @apply relative inline-flex size-8 items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 disabled:pointer-events-none disabled:opacity-50;
  }

  .toolbar-wrapper {
    @apply z-50 custom-scrollbar w-full overflow-hidden border-y border-dark-300 bg-dark-100 pl-3 pr-4 shadow-sm;
  }

  .editor-wrapper {
    height: calc(100vh - 140px);
    width: 100%;
    overflow-y: auto !important; /* Force scrolling to be enabled */
    display: flex;
    justify-content: center;
    padding: 0;
    /* Custom scrollbar styling */
    scrollbar-width: thin;
    scrollbar-color: #565f73 rgb(22, 25, 32);
    -ms-overflow-style: -ms-autohiding-scrollbar;
  }

  /* Custom scrollbar styling for editor-wrapper */
  .editor-wrapper::-webkit-scrollbar {
    /* These styles are now redundant with our global styling */
    /* Keeping this empty to override any previous styles */
  }

  .editor-wrapper::-webkit-scrollbar-track {
    /* These styles are now redundant with our global styling */
    /* Keeping this empty to override any previous styles */
  }

  .editor-wrapper::-webkit-scrollbar-thumb {
    /* These styles are now redundant with our global styling */
    /* Keeping this empty to override any previous styles */
  }

  .editor-wrapper::-webkit-scrollbar-thumb:hover {
    /* These styles are now redundant with our global styling */
    /* Keeping this empty to override any previous styles */
  }

  .header {
    @apply min-h-[92px] w-full flex-nowrap bg-dark-100 flex items-center justify-between gap-2 px-4;
  }

  .document-list-container {
    @apply flex flex-col items-center mb-10 w-full gap-10 px-5;
  }

  .document-list-title {
    @apply max-w-[730px] items-end flex w-full justify-between;
  }

  .document-list-item {
    @apply flex items-center justify-between gap-4 rounded-lg bg-doc bg-cover p-5 shadow-xl;
  }

  .document-list-empty {
    @apply flex w-full max-w-[730px] flex-col items-center justify-center gap-5 rounded-lg bg-dark-200 px-10 py-8;
  }

  .document-title-input {
    @apply min-w-[78px] border-none bg-transparent px-0 text-left text-base font-semibold leading-[24px] focus-visible:ring-0 focus-visible:ring-offset-0 disabled:text-black sm:text-xl md:text-center !important;
  }

  .document-title {
    @apply line-clamp-1 border-dark-400 text-base font-semibold leading-[24px] sm:pl-0 sm:text-xl;
  }

  .view-only-tag {
    @apply rounded-md bg-dark-400/50 px-2 py-0.5 text-xs text-blue-100/50;
  }

  .collaborators-list {
    @apply hidden items-center justify-end -space-x-3 overflow-hidden sm:flex;
  }

  .share-input {
    @apply h-11 flex-1 border-none bg-dark-400 focus-visible:ring-0 focus-visible:ring-offset-0 !important;
  }

  .remove-btn {
    @apply rounded-lg bg-transparent px-0 text-red-500 hover:bg-transparent;
  }

  .comments-container {
    @apply mb-10 space-y-4 lg:w-fit flex w-full flex-col items-center justify-center;
  }

  .comment-composer {
    @apply w-full max-w-[800px] border border-dark-300 bg-dark-200 shadow-sm lg:w-[350px];
  }

  .comment-thread {
    @apply w-full max-w-[800px] border border-dark-300 bg-dark-200 shadow-sm lg:w-[350px] transition-all;
  }

  .loader {
    @apply flex size-full h-screen items-center justify-center gap-3 text-white;
  }

  /* ======================== Auth Pages */
  .auth-page {
    @apply flex h-screen w-full flex-col items-center justify-center gap-10;
  }

  /* ======================== Home Page */
  .home-container {
    @apply relative flex min-h-screen w-full flex-col items-center gap-5 sm:gap-10;
  }

  .document-ul {
    @apply flex w-full max-w-[730px] flex-col gap-5;
  }

  /* ======================== CollaborativeRoom */
  .collaborative-room {
    @apply flex size-full max-h-screen flex-1 flex-col items-center overflow-hidden;
  }

  /* PWA-specific styles */
  .pwa-standalone-mode {
    /* Prevent overscroll effects */
    overscroll-behavior: none;
    /* Prevent text selection for a more app-like feel */
    user-select: none;
    /* Optimize touch targets for mobile */
    touch-action: manipulation;
  }

  /* PWA-optimized scrolling */
  .pwa-scroll {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    scrollbar-width: thin;
  }

  /* Optimize tap targets for mobile */
  .pwa-tap-target {
    min-height: 44px;
    min-width: 44px;
  }

  /* Safe area insets for PWA on iOS */
  .pwa-safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom, 16px);
  }
  
  .pwa-safe-area-top {
    padding-top: env(safe-area-inset-top, 16px);
  }

  /* A4 Paper Styles */
  .a4-paper-container {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    justify-content: flex-start;
    padding: 24px;
    padding-left: calc(10%);
    padding-right: calc(350px + 64px); /* Space for the fixed sidebar */
    min-width: fit-content;
    width: 100%;
    height: fit-content;
    position: relative;
    background-color: rgb(22, 25, 32);
    gap: 24px;
    scrollbar-width: thin;
    scrollbar-color: #565f73 rgb(22, 25, 32);
    transition: padding-right 0.3s ease-in-out; /* Smooth transition when toggling comments */
  }
  
  .dark .a4-paper-container {
    background-color: rgb(22, 25, 32);
  }

  /* A4 papers column container */
  .a4-papers-column {
    display: flex;
    flex-direction: column;
    align-items: center; /* Keep papers centered within the column */
    flex: 0 0 auto; /* Don't allow shrinking */
    margin-left: auto; /* This helps position it correctly with our new container layout */
    margin-right: auto; /* This maintains some balance in the layout */
  }
  
  .a4-paper {
    background-color: rgb(30, 34, 42);
    position: relative;
    margin-bottom: 24px;
    margin-top: 16px;
    padding: 1cm;
    width: 21cm;
    min-height: 29.7cm;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    display: block;
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 4px;
  }
  
  /* Comments sidebar outside the A4 paper */
  .comments-sidebar {
    width: 350px;
    min-height: 400px;
    margin-top: 8px;
    background-color: rgb(24, 26, 32);
    border-radius: 8px;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
    padding: 0;
    flex: 0 0 auto; /* Don't allow shrinking */
    overflow: hidden;
    position: fixed; /* Change from sticky to fixed */
    top: 172px; /* Moved down a bit more (was 164px) */
    right: 40px; /* Moved more to the left (was 32px) */
    height: calc(100vh - 180px); /* Ensure it fits in the visible area */
    display: flex;
    flex-direction: column;
    /* Use a single, clear border that won't stack visually with inner elements */
    border: 1px solid rgba(255, 255, 255, 0.05);
    z-index: 5; /* Lower z-index to allow popups to appear above */
    
    /* Remove any inset shadow that might appear as a second border */
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }
  
  /* Comments section header */
  .comments-section {
    padding: 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    flex-shrink: 0;
    background-color: rgb(24, 26, 32);
    /* Remove any top border that might be causing the double border effect */
    border-top: none;
    box-shadow: none;
    margin-top: 0;
    position: sticky;
    top: 0;
    z-index: 3; /* Above content, but below the container z-index */
  }
  
  /* Comments section heading */
  .comments-section h3 {
    font-size: 18px;
    font-weight: 600;
    color: white;
    margin: 0;
  }
  
  /* Comments threads list styling */
  .comments-threads-list {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 12px;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
    display: flex;
    flex-direction: column;
    gap: 16px;
    background-color: rgb(24, 26, 32);
    height: calc(100% - 140px); /* Adjusted to account for header and composer */
    border-top: none; /* Ensure no additional top border */
    max-height: calc(100vh - 280px); /* Ensure it doesn't overflow the viewport */
  }
  
  /* Hide scrollbar for Chrome, Safari and Opera */
  .comments-threads-list::-webkit-scrollbar {
    display: none;
  }

  .comments-threads-list::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
  }

  .comments-threads-list::-webkit-scrollbar-track {
    background: transparent;
  }
  
  /* Comment thread card - ensure content is visible */
  .comment-thread-card {
    overflow: visible;
    background-color: rgb(30, 34, 42);
    padding: 16px;
    margin-bottom: 12px;
    border-radius: 8px;
    position: relative;
    transition: background-color 0.2s ease;
    height: auto !important;
    z-index: 1; /* Ensure it has a stacking context */
  }
  
  /* Ensure all interactive elements inside comments are properly clickable */
  .comment-thread-card button,
  .comment-thread-card .lb-thread-options-button,
  .comment-thread-card .lb-menu-button,
  .comment-thread-card .lb-emoji-button,
  .comment-thread-card .lb-reaction-button {
    position: relative;
    z-index: 7; /* Above the sidebar but below popups */
    pointer-events: auto; /* Ensure clicks pass through */
  }
  
  .comment-thread-card:hover {
    background-color: rgb(35, 39, 47);
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  /* Avatar styling */
  .comment-thread-header .avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: rgb(45, 50, 60);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
    color: white;
    margin-right: 10px;
    flex-shrink: 0;
    text-transform: uppercase;
  }
  
  /* Username styling */
  .comment-thread-header .username {
    font-size: 14px;
    font-weight: 600;
    color: white;
    margin-right: auto;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  /* Date styling */
  .comment-thread-header .date {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.5);
    white-space: nowrap;
  }
  
  /* Improve comment content styles for visibility */
  .lb-comment-content {
    font-size: 14px;
    line-height: 1.5;
    margin-top: 10px;
    padding: 12px 14px;
    color: rgba(255, 255, 255, 0.9);
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: pre-wrap;
    background-color: rgba(0, 0, 0, 0.15);
    border-radius: 6px;
    display: block !important;
    overflow: visible !important;
    width: 100% !important;
  }
  
  /* Add unread indicator for new comments */
  .comment-thread-card.unread::after {
    content: '';
    position: absolute;
    top: 16px;
    right: 16px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #565f73;
    box-shadow: 0 0 0 2px rgba(86, 95, 115, 0.3);
  }
  
  /* Add reply indicator to show nested comments */
  .comment-thread-card.has-replies::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 3px;
    background: linear-gradient(to bottom, #4e5467, #565f73);
    border-top-left-radius: 12px;
    border-bottom-left-radius: 12px;
  }

  /* Add reply count indicator */
  .comment-thread-card .reply-count {
    display: flex;
    align-items: center;
    font-size: 12px;
    color: rgba(255, 255, 255, 0.6);
    margin-top: 12px;
  }

  .comment-thread-card .reply-count svg {
    width: 14px;
    height: 14px;
    margin-right: 4px;
    opacity: 0.7;
  }
}

/* ======================== Clerk Override */
.cl-avatarBox {
  width: 36px;
  height: 36px;
}

.cl-userButtonTrigger {
  height: fit-content !important;
}

.cl-cardBox,
.cl-signIn-start,
.cl-signUp-start,
.cl-footer {
  background: #060d18;
  box-shadow: none;
  padding: 20px;
}

.cl-socialButtonsBlockButton,
.cl-socialButtonsBlockButton:hover {
  height: 40px;
  background-color: #3371ff;
  color: #fff;
}

.cl-internal-2gzuzc {
  filter: brightness(1000%);
}

.cl-logoBox {
  height: 52px;
}

/* ======================== Liveblocks Override */
.lb-root {
  --lb-accent: #565f73 !important;
  --lb-accent-subtle: #282d38 !important;
  --lb-radius: 0px;
  --lb-dynamic-background: #1a1e27 !important;
}

.lb-comment,
.lb-thread-comments,
.lb-composer,
.lb-comment-reaction {
  background-color: #0f1c34;
  color: #fff;
}

.lb-button {
  --lb-foreground-moderate: #fff;
}

.lb-button:where([data-variant="primary"]) {
  min-height: 36px !important;
  height: 36px !important;
  padding: 0 12px !important;
  font-size: 14px !important;
  margin: 0 0 0 auto !important;
  border-radius: 6px !important;
  background-color: #565f73 !important;
  color: white !important;
  transition: all 0.2s ease !important;
  box-shadow: none !important;
  border: none !important;
}

.lb-button:where(
    [data-variant="default"]:not(
        :is(
            :enabled:hover,
            :enabled:focus-visible,
            [aria-expanded="true"],
            [aria-selected="true"]
          )
      )
  ) {
  color: #b4c6ee;
}

.lb-button:where(
    :enabled:hover,
    :enabled:focus-visible,
    [aria-expanded="true"],
    [aria-selected="true"]
  ) {
  --lb-button-background: #161e30;

  color: #b4c6ee;
}

.lb-inbox-notification-list-item:where(:not(:last-of-type)) {
  border-bottom: none;
}

.lb-comment-body,
.lb-dropdown-item,
.lb-dropdown-item-icon,
.lb-composer-editor {
  color: #fff;
}

.lb-composer-action {
  padding: 8px;
}

.lb-comment-content {
  background: #0b1527;
  margin-top: 16px;
  padding: 12px;
  border-radius: 4px;
  font-size: 14px;
}

.lb-comment-date,
.lb-lexical-mention-suggestion-user,
.lb-composer-suggestions-list-item,
.lb-inbox-notification-date,
.lb-comment-author {
  color: #b4c6ee;
}

.data-liveblocks-portal {
  color: #b4c6ee !important;
}

.lb-root:where(:not(.lb-root .lb-root)) {
  --lb-dynamic-background: #1b2840;
  color: #fff;
}

.lb-composer-editor :where([data-placeholder]) {
  color: #b4c6ee;
  font-size: 14px;
}

.lb-lexical-floating-threads-thread:where([data-resolved]) {
  opacity: 40%;
}

.lb-elevation {
  background: #0f1c34;
}

body {
  -webkit-tap-highlight-color: transparent;
}

/* Add display mode media queries at the end of the file */

/* Display mode specific styles using native CSS instead of tailwindcss-displaymodes */
@media all and (display-mode: standalone), 
       all and (display-mode: fullscreen),
       all and (display-mode: minimal-ui) {
  /* Styles that only apply in PWA standalone mode */
  .pwa-only {
    display: block;
  }
  
  .browser-only {
    display: none;
  }
  
  .pwa-standalone-padding-bottom {
    padding-bottom: env(safe-area-inset-bottom, 16px);
  }
  
  /* Additional PWA specific styles */
  body, html {
    overscroll-behavior: none;
    user-select: none;
    touch-action: manipulation;
  }
}

@media 
  not all and (display-mode: standalone), 
  not all and (display-mode: fullscreen), 
  not all and (display-mode: minimal-ui) {
  /* Styles that only apply in browser mode */
  .pwa-only {
    display: none;
  }
  
  .browser-only {
    display: block;
  }
}

/* Add a4-paper style for the after pseudo-element */
.a4-paper::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 16px;
  pointer-events: none;
  background: linear-gradient(transparent, rgba(0, 0, 0, 0.1));
}

/* Editor container */
.editor-container {
  background-color: rgb(18, 20, 25);
}

/* Toolbar styling */
.toolbar-wrapper {
  background-color: rgb(25, 28, 35) !important;
  border-color: rgba(255, 255, 255, 0.05) !important;
  padding: 8px 16px;
}

/* Editor input styling */
.editor-input {
  color: rgba(255, 255, 255, 0.9) !important;
  font-size: 15px !important;
  line-height: 1.5 !important;
}

.editor-placeholder {
  color: rgba(255, 255, 255, 0.4) !important;
}

/* Floating toolbar styling */
.floating-toolbar {
  background-color: rgb(43, 47, 55) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
}

.floating-toolbar-btn {
  color: rgba(255, 255, 255, 0.8) !important;
}

.floating-toolbar-btn:hover {
  background-color: rgba(255, 255, 255, 0.1) !important;
}

/* Page number styling */
.page-number {
  color: rgba(255, 255, 255, 0.4) !important;
  font-size: 11px !important;
  bottom: 6px !important;
  right: 6px !important;
}

/* Make thread comments wrap better */
.lb-thread, .lb-thread-comments {
  max-width: 100% !important;
  width: 100% !important;
}

/* Improve thread container */
.comment-thread-card .lb-thread {
  padding: 0 !important;
  margin: 0 !important;
}

/* Allow content to wrap better */
.lb-comment-body {
  white-space: normal !important;
  overflow-wrap: break-word !important;
  word-break: break-word !important;
}

/* Fix comment composer to ensure proper width */
.lb-composer {
  width: 100% !important;
}

/* Override Liveblocks button styles */
.lb-button {
  background-color: rgb(55, 60, 70) !important;
  color: white !important;
  border-radius: 6px !important;
  font-size: 13px !important;
  font-weight: 500 !important;
  height: 32px !important;
  padding: 0 12px !important;
  transition: all 0.2s ease !important;
}

.lb-button:hover {
  background-color: rgb(65, 70, 85) !important;
}

/* Liveblocks suggestion styling */
.lb-composer-suggestions-list {
  background-color: rgb(30, 33, 40) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-radius: 8px !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
}

.lb-composer-suggestions-list-item {
  color: white !important;
  padding: 8px 12px !important;
}

.lb-composer-suggestions-list-item:hover,
.lb-composer-suggestions-list-item[aria-selected="true"] {
  background-color: rgba(255, 255, 255, 0.1) !important;
}

/* FloatingComposer styling */
.lb-lexical-floating-composer {
  background-color: rgb(30, 33, 40) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-radius: 8px !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
  padding: 14px !important;
}

/* Adjust the composer actions row */
.lb-composer-actions {
  margin-top: 0 !important; 
  margin-bottom: 6px !important;
  padding: 0 12px 8px !important;
  display: flex !important;
  justify-content: flex-end !important;
  align-items: center !important;
}

/* Comments container for the composer at the bottom */
.comments-container {
  position: absolute !important; /* Change from sticky to absolute */
  bottom: 0 !important;
  left: 0 !important;
  right: 0 !important;
  width: 100% !important;
  padding: 10px 12px !important;
  background-color: rgb(24, 26, 32) !important;
  border-top: 1px solid rgba(255, 255, 255, 0.05) !important;
  margin: 0 !important;
  z-index: 10 !important;
  height: auto !important;
  min-height: 110px !important;
  max-height: 110px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  box-sizing: border-box !important;
}

/* Comment composer styling */
.comment-composer {
  width: 100% !important;
  height: 100% !important;
  border-radius: 6px !important;
  overflow: hidden !important;
  background-color: rgb(35, 39, 47) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
  min-height: 100px !important;
  max-height: none !important;
  display: flex !important;
  flex-direction: column !important;
  margin: 0 !important;
}

/* Remove any margins from the composer */
.lb-composer {
  padding: 0 !important;
  height: 100% !important;
  display: flex !important;
  flex-direction: column !important;
}

/* Remove any margins from the editor input except for bottom */
.lb-composer-editor {
  min-height: 60px !important;
  height: 60px !important;
  max-height: none !important;
  padding: 12px 14px !important;
  font-size: 15px !important;
  background: transparent !important;
  resize: none !important;
  line-height: 1.6 !important;
  flex: 1 !important;
  margin-top: 0 !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  margin-bottom: 4px !important;
}

.lb-composer-editor:focus {
  outline: none !important;
  box-shadow: none !important;
}

.lb-composer-editor::placeholder {
  color: rgba(255, 255, 255, 0.4) !important;
  font-size: 15px !important;
  font-style: italic !important;
}

/* Thread styling overrides */
.lb-thread, .lb-thread-comments {
  max-width: 100% !important;
  width: 100% !important;
  background-color: transparent !important;
}

.comments-container {
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.comment-thread-card .lb-thread {
  padding: 0 !important;
  margin: 0 !important;
  border: none !important;
  background-color: transparent !important;
}

/* Thread header styling */
.comment-thread-header {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}

/* Make sure thread content is fully visible */
.comment-thread {
  width: 100%;
  padding: 0 !important;
  margin: 0 !important;
  border: none !important;
  background-color: transparent !important;
  overflow: visible !important;
}

/* Ensure thread comments are visible */
.lb-thread-comments {
  max-width: 100% !important;
  width: 100% !important;
  background-color: transparent !important;
  padding: 0 !important;
  margin: 0 !important;
  overflow: visible !important;
}

/* Comment styling within threads */
.lb-comment {
  background-color: transparent !important;
  padding: 12px 0 !important;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
  overflow: visible !important;
  margin-bottom: 4px !important;
}

/* Improve comment content styles for visibility */
.lb-comment-content {
  font-size: 14px;
  line-height: 1.5;
  margin-top: 10px;
  padding: 12px 14px;
  color: rgba(255, 255, 255, 0.9);
  word-break: break-word;
  overflow-wrap: break-word;
  white-space: pre-wrap;
  background-color: rgba(0, 0, 0, 0.15);
  border-radius: 6px;
  display: block !important;
  overflow: visible !important;
  width: 100% !important;
}

/* Ensure comment content wraps properly */
.lb-comment-body p {
  white-space: normal !important;
  overflow-wrap: break-word !important;
  word-break: break-word !important;
  margin: 0 !important;
  padding: 0 !important;
  font-size: 14px !important;
  line-height: 1.5 !important;
}

/* Ensure the thread itself displays properly */
.lb-thread {
  display: flex !important;
  flex-direction: column !important;
  width: 100% !important;
  max-width: 100% !important;
  overflow: visible !important;
  padding: 0 !important;
  margin: 0 !important;
  background-color: transparent !important;
}

/* Improve the comment container */
.comment-thread-card {
  overflow: visible;
  background-color: rgb(30, 34, 42);
  padding: 16px;
  margin-bottom: 12px;
  border-radius: 8px;
  position: relative;
  transition: background-color 0.2s ease;
  height: auto !important;
  z-index: 1; /* Ensure it has a stacking context */
}

/* Update Liveblocks theme colors to match dark theme */
.lb-root {
  --lb-accent: #565f73 !important;
  --lb-accent-subtle: #282d38 !important;
  --lb-radius: 0px;
  --lb-dynamic-background: #1a1e27 !important;
}

/* Primary button colors for send button */
.lb-button:where([data-variant="primary"]) {
  min-height: 36px !important;
  height: 36px !important;
  padding: 0 12px !important;
  font-size: 14px !important;
  margin: 0 0 0 auto !important;
  border-radius: 6px !important;
  background-color: #565f73 !important;
  color: white !important;
  transition: all 0.2s ease !important;
  box-shadow: none !important;
  border: none !important;
}

.lb-button:where([data-variant="primary"]):hover {
  background-color: #636c84 !important;
}

/* Toolbar button colors */
.lb-composer-toolbar-button {
  width: 36px !important;
  height: 36px !important;
  min-width: 36px !important;
  min-height: 36px !important;
  border-radius: 6px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  background-color: rgb(40, 44, 52) !important;
  color: rgba(255, 255, 255, 0.8) !important;
  transition: all 0.2s ease !important;
  margin: 0 4px !important;
}

.lb-composer-toolbar-button:hover {
  background-color: #565f73 !important;
  color: white !important;
}

/* Mention styling in composer */
.lb-lexical-mention-node {
  color: white !important;
  background-color: #565f73 !important;
  border-radius: 4px !important;
  padding: 1px 4px !important;
  font-weight: 500 !important;
}

/* Selected items in dropdown */
.lb-composer-suggestions-list-item[aria-selected="true"] {
  background-color: #565f73 !important;
}

.lb-composer-editor:focus {
  outline: none !important;
  box-shadow: none !important;
}

/* Ensure no margin in the Liveblocks components */
.lb-root {
  margin: 0 !important;
}

/* Fix possible extra margins in the toolbar */
.lb-composer-toolbar {
  margin: 0 !important;
  padding: 0 !important;
}

/* Ensure no margins in the action row */
.lb-composer-actions {
  margin-top: 0 !important; 
  padding: 8px 10px !important;
  display: flex !important;
  justify-content: flex-end !important;
}

/* Fix button position */
.lb-button:where([data-variant="primary"]) {
  min-height: 40px !important;
  height: 40px !important;
  padding: 0 15px !important;
  font-size: 15px !important;
  margin: 0 0 0 auto !important;
}

/* Comment thread styling */
.comment-thread {
  width: 100%;
  background-color: transparent !important;
  border: none !important;
  padding: 0 !important;
}

/* Thread styling overrides */
.lb-thread, .lb-thread-comments {
  max-width: 100% !important;
  width: 100% !important;
  background-color: transparent !important;
}

.comment-thread-card .lb-thread {
  padding: 0 !important;
  margin: 0 !important;
  border: none !important;
}

/* Styling Liveblocks comments in threads */
.lb-comment {
  background-color: transparent !important;
  padding: 12px 0 !important;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
  overflow: visible !important;
  margin-bottom: 4px !important;
}

.lb-comment:last-child {
  border-bottom: none !important;
}

.lb-comment-author {
  font-size: 14px !important;
  font-weight: 600 !important;
  color: white !important;
}

.lb-comment-date {
  font-size: 12px !important;
  color: rgba(255, 255, 255, 0.5) !important;
  margin-left: 8px !important;
}

.lb-comment-body {
  padding: 8px 0 0 !important;
  margin: 0 !important;
  white-space: normal !important;
  overflow-wrap: break-word !important;
  word-break: break-word !important;
  display: block !important;
  width: 100% !important;
  font-size: 14px !important;
  line-height: 1.5 !important;
  color: rgba(255, 255, 255, 0.9) !important;
}

/* Target all Liveblocks components to remove any margins */
.comments-container * {
  margin-top: 0 !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  box-sizing: border-box !important;
}

/* Only allow margins that we explicitly define */
.lb-composer-actions {
  margin-top: 0 !important; 
  margin-bottom: 6px !important;
  padding: 8px 10px !important;
  display: flex !important;
  justify-content: flex-end !important;
}

/* Composer toolbar buttons styling */
.lb-composer-toolbar-button {
  width: 36px !important;
  height: 36px !important;
  min-width: 36px !important;
  min-height: 36px !important;
  border-radius: 6px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  background-color: rgb(40, 44, 52) !important;
  color: rgba(255, 255, 255, 0.8) !important;
  transition: all 0.2s ease !important;
  margin: 0 4px !important;
}

.lb-composer-toolbar-button:hover {
  background-color: #565f73 !important;
  color: white !important;
}

/* Composer toolbar container styling */
.lb-composer-toolbar {
  margin: 0 !important;
  padding: 8px 12px !important;
  display: flex !important;
  justify-content: flex-start !important;
  align-items: center !important;
}

/* Empty state when no comments exist */
.no-comments-state {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  text-align: center;
  color: rgba(255, 255, 255, 0.5);
}

/* Empty state icon */
.no-comments-state svg {
  width: 32px;
  height: 32px;
  opacity: 0.5;
  margin-bottom: 12px;
}

/* Empty state main text */
.no-comments-state p {
  font-size: 16px;
  font-weight: 500;
  margin: 0;
}

/* Empty state hint text */
.no-comments-state .hint {
  font-size: 14px;
  opacity: 0.7;
  margin-top: 8px;
}

/* Additional fix to ensure no duplicate top borders */
.comments-sidebar:before {
  content: none !important; /* Prevent any generated content that might add a pseudo-border */
}

.comments-section:first-child {
  border-top: none !important;
}

.comments-sidebar > *:first-child {
  border-top: none !important;
}

/* Fix double border issue in comments sidebar */
.comments-sidebar *:not(.comment-thread-card, .lb-comment) {
  border-top: none !important;
}

/* Fix possible border styles from Liveblocks components */
.lb-root div[data-part="header"], 
.lb-thread[data-part="header"] {
  border-top: none !important;
}

/* Adjust padding when comments are not showing (desktop only) */
@media (min-width: 768px) {
  .a4-paper-container.without-comments {
    padding-right: 64px; /* Reduced padding when no comments */
  }
}

/* Ensure Liveblocks popups and dropdowns appear above the sidebar */
.lb-popover,
.lb-dropdown,
.lb-emoji-picker,
.lb-dropdown-menu,
.lb-dropdown-content,
.lb-menu-content,
.lb-dropdown-item,
.lb-thread-options,
.lb-thread-menu,
.lb-reaction-selector {
  z-index: 20 !important; /* Higher than the comments sidebar */
}

/* Fix thread settings button to ensure it's clickable */
.lb-thread-menu-button,
.lb-thread-options-button,
.lb-menu-button,
.lb-button {
  position: relative;
  z-index: 6 !important; /* Just above the sidebar */
}

/* Ensure emoji picker works correctly */
.lb-emoji-picker {
  position: absolute !important;
  background-color: rgb(35, 39, 47) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-radius: 8px !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
}

/* Make thread comment items fully clickable */
.lb-comment,
.lb-thread,
.lb-comment-content,
.lb-comment-body {
  position: relative;
}

/* Ensure thread menu buttons work properly */
.lb-thread-header-container,
.lb-thread-header {
  position: relative;
  z-index: 6;
}

/* Ensure menu buttons are clickable and visible */
.lb-thread-menu-trigger,
.lb-thread-options {
  position: relative !important;
  z-index: 7 !important;
}

/* Ensure emoji picker displays correctly */
[data-radix-popper-content-wrapper],
[role="dialog"],
[data-state="open"] {
  z-index: 50 !important;
  /* Constrain to viewport */
  max-width: 90vw !important;
  max-height: 90vh !important;
}

/* Style the emoji picker specifically */
.lb-emoji-picker {
  position: absolute !important;
  z-index: 50 !important;
  max-height: 320px !important;
  overflow-y: auto !important;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
  /* Force left positioning for emoji picker in comments sidebar */
  transform: translateX(-100%) !important;
  right: 100% !important;
  left: auto !important;
}

/* Ensure emoji button has position context */
.lb-emoji-button,
.lb-composer-toolbar-button {
  position: relative !important;
}

/* Make LiveBlocks thread menus work properly */
[data-live-state="open"] {
  z-index: 50 !important;
}

/* Ensure clickable elements work inside threads */
.lb-thread * {
  pointer-events: auto !important;
}

/* Fix dropdown positioning */
.lb-dropdown {
  transform-origin: top right !important;
  z-index: 100 !important;
  position: absolute !important;
  top: auto !important;
  right: 0 !important;
  left: auto !important;
  width: auto !important;
}

/* Fix emoji picker positioning in comments sidebar */
.comments-sidebar .lb-emoji-picker,
.comments-sidebar [data-radix-popper-content-wrapper] {
  transform: translateX(-100%) !important;
  right: 100% !important;
  left: auto !important;
  top: 0 !important;
  margin-right: 8px !important;
}

/* Ensure emoji grid layout is compact enough */
.comments-sidebar .lb-emoji-picker-content {
  display: grid !important;
  grid-template-columns: repeat(5, 1fr) !important;
  gap: 8px !important;
  padding: 12px !important;
}

/* Make emoji picker look better */
.lb-emoji-picker {
  background-color: rgb(30, 34, 42) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-radius: 8px !important;
  padding: 4px !important;
  min-width: 250px !important;
  max-width: 320px !important;
}

/* Ensure popups stay within viewport - general approach */
.comments-sidebar .lb-popover,
.comments-sidebar .lb-dropdown,
.comments-sidebar [data-radix-popper-content-wrapper],
.comments-sidebar [data-state="open"] {
  position: fixed !important;
  right: auto !important;
  left: auto !important;
  max-width: 300px !important;
  /* Position to the left of the sidebar */
  transform: translateX(calc(-100% - 380px)) !important;
}

/* Adjust positioning for specific types of dropdowns */
.comments-sidebar .lb-thread-header [data-state="open"],
.comments-sidebar .lb-thread-options-content {
  transform: none !important;
  right: 100% !important;
  left: auto !important;
  margin-right: 8px !important;
}

/* Fix emoji button and position */
.lb-emoji-button {
  position: relative !important;
  z-index: 10 !important;
}